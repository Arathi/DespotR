# UND笔记 #
这是一系列关于UND实现的调研。

# Dragon Quest的战斗系统 #
战斗，首先得有参与战斗的对象：玩家单位和怪物单位。

## 单位系统： ##
单位系统是描述单位的属性、定义单位的行为的系统。对于参与战斗计算的单位属性，有如下几项：

### 生命值 ###
顾名思义，生命值掉到0或0以下，单位就会死亡。

### 法力值 ###
使用咒文消耗的能量，如果剩余法力值不足，咒文将不能选取。如果在战斗中被抽取法力导致不能施法，提示MP不足，该回合的动作不会被转换为攻击。

### 攻击力 ###
玩家单位的攻击力由力量和武器决定，怪物的攻击力即属性表给出的攻击力。

### 防御力 ###
玩家单位的防御力由敏捷和防具决定，怪物的防御力即属性表给出的防御力。

### 敏捷 ###
决定攻击顺序、逃跑成功率以及玩家单位防御力。

### 闪避 ###
决定被攻击时发生闪避使攻击无效的概率，这个概率为闪避值的1/64。

### 爆击 ###
决定攻击时出现会心一击，无视对方防御力造成伤害的概率，爆击率一般是1/32。

### 抗性 ###
决定魔法无效化的概率。

## 单位行为 ##
玩家单位的行为有如下几种：

### 攻击 ###
对敌方一个单位发动物理攻击，可以被武器的技能覆盖。

### 防御 ###
该回合受到的伤害减少一半。

### 咒文 ###
用在战斗中的咒文主要有伤害类、恢复类和Buff类三种，玩家在战斗中能用到的有荷伊米、基拉、拉里荷、马荷东、贝荷伊米、贝吉拉马。

### 物品 ###
一些物品在战斗中使用，一般有武器的主动效果、药草、祈祷戒指、贤者之石等；战斗中可以切换装备，但一回合只能换一件。

### 逃跑 ###
有一定概率从战斗中脱离，概率与面对的怪物级别与敏捷相关，怪物逃跑成功率总是为1/4，如果对方单位处于睡眠和防御状态，逃跑必定成功。

## 伤害值计算 ##

伤害值的计算公式如下：

    攻防差=攻击力-防御力*0.5
    普通最小伤害值=攻防差*0.45
    普通最大伤害值=攻防差*0.55
    爆击最小伤害值=(攻击力/2+1)~攻击力
    爆击最大伤害值=攻击力

